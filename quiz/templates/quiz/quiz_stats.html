{% extends 'quiz/base.html' %}

{% block content %}

<style>
    .stats-header {
        background: linear-gradient(90deg, #f0f7ff 0%, #f9eef8 100%);
        padding: 2.5rem 1.5rem;
        border-radius: 12px;
        margin-bottom: 2.5rem;
        box-shadow: 0 10px 26px rgba(50, 50, 93, 0.05);
        text-align: center;
    }
    .stats-header h1 {
        font-weight: 800;
        margin: 0 0 0.5rem 0;
        font-size: 2.8rem;
        color: #0f172a;
    }
    .stats-header p { color: #4b5563; font-size: 1.05rem; }
    .stat-card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }
    .stat-card .card-header {
        border-radius: 10px 10px 0 0;
        font-weight: 600;
        padding: 1.25rem;
    }
    .difficulty-item {
        margin-bottom: 1.5rem;
    }
    .difficulty-label {
        font-weight: 600;
        font-size: 1.05rem;
        margin-bottom: 0.5rem;
    }
    .progress {
        border-radius: 5px;
    }
    .table-responsive {
        border-radius: 10px;
    }
    table thead {
        background-color: #f8f9fa;
    }
    table th {
        font-weight: 700;
        color: #333;
        border: none;
        padding: 1rem;
    }
    table td {
        padding: 1rem;
        border-color: #e9ecef;
    }
    .quiz-title {
        font-weight: 600;
        color: #333;
    }
    .success-rate-badge {
        font-weight: 700;
        min-width: 60px;
    }
    .back-home-section {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 2px solid #e9ecef;
        text-align: center;
    }
    .back-home-btn {
        padding: 0.75rem 2rem;
        font-weight: 600;
        font-size: 1.05rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    .back-home-btn:hover {
        transform: scale(1.05);
    }
    .info-box {
        background-color: #f0f7ff;
        border-left: 4px solid #667eea;
        border-radius: 8px;
    }
</style>

<div class="container mt-5 mb-5">
    <!-- Header Section -->
    <div class="stats-header">
        <h1><i class="bi bi-bar-chart-line me-3"></i>Quiz Statistics</h1>
        <p class="mb-0 mt-2">Analyze quiz performance and difficulty distribution across the platform</p>
    </div>

    <!-- Difficulty Distribution Section -->
    <div class="row mb-4">
        <div class="col-md-6 mx-auto">
            <div class="card stat-card">
                <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-pie-chart me-2"></i>Difficulty Distribution</h5>
                </div>
                <div class="card-body p-4">
                    <!-- Easy Section -->
                    <div class="difficulty-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="difficulty-label">
                                <i class="bi bi-emoji-smile me-2" style="color: #28a745;"></i>Easy
                            </span>
                            <span class="badge bg-success fs-6">{{ difficulty_counts.Easy }}</span>
                        </div>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-success fw-bold d-flex align-items-center justify-content-center" 
                                 role="progressbar" 
                                 style="width: {% widthratio difficulty_counts.Easy total_quizzes 100 %}%; color: white; font-size: 0.85rem;" 
                                 aria-valuenow="{{ difficulty_counts.Easy }}" aria-valuemin="0" aria-valuemax="{{ total_quizzes }}">
                                {% widthratio difficulty_counts.Easy total_quizzes 100 %}%
                            </div>
                        </div>
                    </div>

                    <!-- Medium Section -->
                    <div class="difficulty-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="difficulty-label">
                                <i class="bi bi-emoji-neutral me-2" style="color: #ffc107;"></i>Medium
                            </span>
                            <span class="badge bg-warning fs-6">{{ difficulty_counts.Medium }}</span>
                        </div>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-warning fw-bold d-flex align-items-center justify-content-center" 
                                 role="progressbar" 
                                 style="width: {% widthratio difficulty_counts.Medium total_quizzes 100 %}%; color: #333; font-size: 0.85rem;" 
                                 aria-valuenow="{{ difficulty_counts.Medium }}" aria-valuemin="0" aria-valuemax="{{ total_quizzes }}">
                                {% widthratio difficulty_counts.Medium total_quizzes 100 %}%
                            </div>
                        </div>
                    </div>

                    <!-- Hard Section -->
                    <div class="difficulty-item mb-0">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="difficulty-label">
                                <i class="bi bi-emoji-frown me-2" style="color: #dc3545;"></i>Hard
                            </span>
                            <span class="badge bg-danger fs-6">{{ difficulty_counts.Hard }}</span>
                        </div>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-danger fw-bold d-flex align-items-center justify-content-center" 
                                 role="progressbar" 
                                 style="width: {% widthratio difficulty_counts.Hard total_quizzes 100 %}%; color: white; font-size: 0.85rem;" 
                                 aria-valuenow="{{ difficulty_counts.Hard }}" aria-valuemin="0" aria-valuemax="{{ total_quizzes }}">
                                {% widthratio difficulty_counts.Hard total_quizzes 100 %}%
                            </div>
                        </div>
                    </div>

                    <p class="text-muted mt-4 mb-0 text-center">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Total Quizzes:</strong> {{ total_quizzes }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Success Rate Section -->
    <div class="row">
        <div class="col-md-12">
            <div class="card stat-card">
                <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Quiz Performance Metrics</h5>
                </div>
                <div class="card-body p-4">
                    {% if quiz_stats_list %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 5%;">Rank</th>
                                    <th style="width: 25%;"><strong>Quiz Title</strong></th>
                                    <th style="width: 15%;"><strong>Topic</strong></th>
                                    <th style="width: 15%;"><strong>Difficulty</strong></th>
                                    <th style="width: 10%;"><strong>Attempts</strong></th>
                                    <th style="width: 20%;"><strong>Success Rate</strong></th>
                                    <th style="width: 10%;"><strong>Max Score</strong></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in quiz_stats_list %}
                                <tr>
                                    <td>
                                        <span class="badge bg-secondary fs-6">{{ forloop.counter }}</span>
                                    </td>
                                    <td class="quiz-title">{{ stat.quiz.title }}</td>
                                    <td><strong>{{ stat.quiz.topic }}</strong></td>
                                    <td>
                                        {% if stat.quiz.difficulty == 'Easy' %}
                                            <span class="badge bg-success fs-6 px-3 py-2">
                                                <i class="bi bi-emoji-smile me-1"></i>Easy
                                            </span>
                                        {% elif stat.quiz.difficulty == 'Medium' %}
                                            <span class="badge bg-warning fs-6 px-3 py-2" style="color: #333;">
                                                <i class="bi bi-emoji-neutral me-1"></i>Medium
                                            </span>
                                        {% else %}
                                            <span class="badge bg-danger fs-6 px-3 py-2">
                                                <i class="bi bi-emoji-frown me-1"></i>Hard
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td><strong class="fs-6">{{ stat.total_attempts }}</strong></td>
                                    <td>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="progress flex-grow-1" style="height: 25px; min-width: 80px;">
                                                {% if stat.success_rate >= 70 %}
                                                    <div class="progress-bar bg-success fw-bold d-flex align-items-center justify-content-center" 
                                                         style="width: {{ stat.success_rate }}%; color: white; font-size: 0.8rem;">
                                                        {{ stat.success_rate }}%
                                                    </div>
                                                {% elif stat.success_rate >= 50 %}
                                                    <div class="progress-bar bg-warning fw-bold d-flex align-items-center justify-content-center" 
                                                         style="width: {{ stat.success_rate }}%; color: #333; font-size: 0.8rem;">
                                                        {{ stat.success_rate }}%
                                                    </div>
                                                {% else %}
                                                    <div class="progress-bar bg-danger fw-bold d-flex align-items-center justify-content-center" 
                                                         style="width: {{ stat.success_rate }}%; color: white; font-size: 0.8rem;">
                                                        {{ stat.success_rate }}%
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    <td><strong class="fs-6">{{ stat.max_score }}</strong></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info text-center mb-0" role="alert">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>No Quiz Data Available Yet</strong><br>
                        <small>Quizzes will appear here once users start attempting them.</small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Information Box -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="alert info-box" role="alert">
                <h5 class="mb-3"><i class="bi bi-lightbulb me-2"></i>How to Read These Statistics</h5>
                <ul class="mb-0">
                    <li><strong>Success Rate:</strong> Percentage of attempts where users scored at least 50% of the maximum possible score</li>
                    <li><strong>Max Score:</strong> Total number of questions in the quiz</li>
                    <li><strong>Attempts:</strong> Total number of times all users have attempted this quiz</li>
                    <li><strong>Difficulty Distribution:</strong> Breakdown of all quizzes by difficulty level</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Back to Home Section -->
    <div class="back-home-section">
        <a href="{% url 'home' %}" class="btn btn-primary back-home-btn">
            <i class="bi bi-house-fill me-2"></i>Back to Home
        </a>
    </div>
</div>

{% endblock %}

